import sys
from PyQt5.QtWidgets import QApplication, QWidget, QLineEdit, QPushButton, QLabel, QTextBrowser, QGridLayout
import requests
from bs4 import BeautifulSoup
## http://codetorial.net/pyqt5/widget/qtextbrowser_advanced.html

class MyApp(QWidget):

    def __init__(self):
        super().__init__()

        self.initUI()

    def initUI(self):

        self.le = QLineEdit()
        self.le.setPlaceholderText('Enter your search word')
        self.le.returnPressed.connect(self.crawl_news)

        self.btn = QPushButton('Search')
        self.btn.clicked.connect(self.crawl_news)

        self.lbl = QLabel('')

        self.tb = QTextBrowser()
        self.tb.setAcceptRichText(True)
        self.tb.setOpenExternalLinks(True)

        grid = QGridLayout()
        grid.addWidget(self.le, 0, 0, 1, 3)
        grid.addWidget(self.btn, 0, 3, 1, 1)
        grid.addWidget(self.lbl, 1, 0, 1, 4)
        grid.addWidget(self.tb, 2, 0, 1, 4)

        self.setLayout(grid)

        self.setWindowTitle('Web Crawler')
        self.setGeometry(100, 100, 700, 450)
        self.show()

    def crawl_news(self):
        search_word = self.le.text()

        if search_word:
            self.lbl.setText('Google : 검색 "' + search_word + '"')
            self.tb.clear()
            url_search = 'https://www.google.com/search?q='
            url = url_search + search_word + '&ie=UTF-8'
            r = requests.get(url)
            html = r.content
            soup = BeautifulSoup(html, 'lxml')
            titles_html = soup.select('a')
            # rso > div:nth-child(2) > div > div:nth-child(1) > div > div.r > a > h3
            self.tb.append(f'{len(titles_html)}________개 의 text')
            for i in range(18,38,1):
                self.tb.append(f'{str(i+1)} :    {titles_html[i].text}' )
                self.tb.append(titles_html[i].get('href'))

if __name__ == '__main__':

    app = QApplication(sys.argv)
    ex = MyApp()
    sys.exit(app.exec_())
